<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<meta name="theme-color" content="#0b0f1a"/>
<title>Nitin’s Playlist · Neon Player</title>

<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;900&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet"/>

<style>
  :root{
    --bg:#060913;--panel:#0b1022;--text:#dfe7ff;--muted:#95a0c7;
    --primary:#8a5cff;--secondary:#27e0ff;--accent:#ff3fb4;--youtube:#ff0000;
    --card-radius:22px;--neon:drop-shadow(0 0 12px rgba(69,220,255,.65)) drop-shadow(0 0 32px rgba(175,88,255,.55));
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{
    margin:0;font-family:'Outfit',system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,Apple Color Emoji,Segoe UI Emoji;
    color:var(--text);
    background:
      radial-gradient(1200px 1200px at 70% -10%, rgba(123,64,255,.30), transparent 45%),
      radial-gradient(900px 900px at -10% 90%, rgba(25,185,255,.25), transparent 45%),
      radial-gradient(600px 600px at 120% 50%, rgba(255,58,164,.2), transparent 40%),
      var(--bg);
    background-attachment:fixed;overflow-x:hidden;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;
    padding-top:env(safe-area-inset-top);padding-bottom:env(safe-area-inset-bottom);
  }

  /* Floating orbs (original animation preserved) */
  .orbs{pointer-events:none;position:fixed;inset:0;overflow:hidden;z-index:0;filter:blur(40px) saturate(140%)}
  .orb{position:absolute;width:260px;height:260px;border-radius:999px;background:radial-gradient(circle at 30% 30%, rgba(39,224,255,.9), transparent 60%);animation:float 18s ease-in-out infinite;mix-blend-mode:screen;opacity:.35}
  .orb.pink{background:radial-gradient(circle at 70% 30%, rgba(255,63,180,.9), transparent 60%)}
  .orb.violet{background:radial-gradient(circle at 40% 60%, rgba(138,92,255,.9), transparent 60%)}
  @keyframes float{0%,100%{transform:translate3d(0,0,0) scale(1)}50%{transform:translate3d(20px,-30px,0) scale(1.08)}}

  .neon{
    font-weight:900;letter-spacing:.02em;line-height:.95;
    background:conic-gradient(from 180deg at 50% 50%, var(--secondary), var(--primary), var(--accent), var(--secondary));
    background-size:200% 200%;-webkit-background-clip:text;background-clip:text;color:transparent;
    animation:hueShift 8s ease-in-out infinite;filter:var(--neon);
    text-shadow:0 0 1px rgba(255,255,255,.35),0 2px 0 rgba(0,0,0,.25),0 8px 40px rgba(0,0,0,.35);
  }
  @keyframes hueShift{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}

  .screen{min-height:100dvh;display:grid;place-items:center;position:relative;z-index:1;transition:opacity .3s ease,visibility .3s ease;width:100%}
  .screen.hidden{opacity:0;visibility:hidden;pointer-events:none;position:absolute;top:0;left:0}
  .hidden{display:none!important}
  .container{width:min(100%,1080px);padding:clamp(14px,3.6vw,28px)}
  .hero{text-align:center;padding-block:clamp(16px,8vh,72px)}
  .hero h1{margin:24px 0 14px;font-size:clamp(42px,12vw,110px)}
  .hero p{margin:0 auto;max-width:40ch;font-family:Inter;color:var(--muted);font-weight:400;font-size:clamp(16px,3.8vw,20px)}
  .cta{margin-top:36px;display:inline-grid;place-items:center;padding:16px 24px;border-radius:16px;background:linear-gradient(90deg, rgba(39,224,255,.95), rgba(138,92,255,.95));color:#02101a;font-weight:800;text-decoration:none;transition:transform .15s ease,filter .2s ease;box-shadow:0 12px 40px rgba(50,50,93,.35),0 8px 18px -8px rgba(39,224,255,.5)}
  .cta:active{transform:scale(.98)}

  header{display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap;margin-bottom:18px}
  header h2{font-size:clamp(28px,8vw,62px);margin:0}
  .actions{display:flex;gap:12px;flex-wrap:wrap}
  .btn{display:inline-flex;align-items:center;gap:10px;padding:12px 14px;border-radius:14px;background:rgba(255,255,255,.06);backdrop-filter:blur(6px);color:var(--text);text-decoration:none;font-weight:700;border:1px solid rgba(255,255,255,.08);box-shadow:inset 0 0 0 1px rgba(255,255,255,.02);transition:transform .2s ease,background .2s ease,border-color .2s ease;cursor:pointer}
  .btn:hover{transform:translateY(-1px);background:rgba(255,255,255,.10)}
  .btn:active{transform:translateY(0) scale(.98)}
  .btn.youtube{background:radial-gradient(120% 120% at -10% 120%, rgba(255,255,255,.06), transparent 55%), rgba(244,0,0,.2)}
  .btn .icon{width:20px;height:20px}
  .search-container{margin-bottom:18px}
  #searchInput{width:100%;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:rgba(0,0,0,.35);color:var(--text);outline:none;font-family:Inter}
  .grid{display:grid;grid-template-columns:repeat(auto-fill, minmax(200px,1fr));gap:16px;margin-top:14px}
  @media(min-width:480px){.grid{grid-template-columns:repeat(2,1fr)}}
  @media(min-width:740px){.grid{grid-template-columns:repeat(4,1fr)}}
  .card{position:relative;border-radius:var(--card-radius);overflow:hidden;background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));border:1px solid rgba(255,255,255,.1);box-shadow:0 8px 30px rgba(0,0,0,.35);transform:translateZ(0);transition:transform .25s cubic-bezier(.2,.8,.2,1), box-shadow .25s ease;cursor:pointer;isolation:isolate}
  .card:hover{transform:translateY(-4px) scale(1.01);box-shadow:0 18px 50px rgba(0,0,0,.45)}
  .card:active{transform:translateY(0) scale(.995)}
  .card.playing{border-color:var(--primary);box-shadow:0 0 20px rgba(138,92,255,.4),0 18px 50px rgba(0,0,0,.45)}
  .card.youtube{border-color:rgba(255,0,0,.3)}
  .card.youtube .youtube-badge{position:absolute;top:10px;left:10px;background:var(--youtube);color:#fff;padding:4px 8px;border-radius:6px;font-size:11px;font-weight:700;z-index:5}
  .card .play-indicator{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,.8);border-radius:50%;width:60px;height:60px;display:grid;place-items:center;opacity:0;transition:opacity .2s ease;z-index:10}
  .card:hover .play-indicator,.card.playing .play-indicator{opacity:1}
  .card .delete-btn{position:absolute;top:10px;right:10px;background:rgba(0,0,0,.7);color:#fff;border:none;border-radius:50%;width:28px;height:28px;display:grid;place-items:center;cursor:pointer;opacity:0;transition:opacity .2s ease;z-index:5;font-size:16px}
  .card:hover .delete-btn{opacity:1}
  .card .glow{position:absolute;inset:-1px;border-radius:inherit;pointer-events:none;background:radial-gradient(500px 180px at 50% 10%, rgba(39,224,255,.25), transparent 60%), radial-gradient(400px 200px at 20% 10%, rgba(138,92,255,.2), transparent 60%);opacity:.8;mix-blend-mode:screen;transition:opacity .3s ease}
  .card:hover .glow{opacity:1}
  .card .img{position:relative;width:100%;padding-top:115%;overflow:hidden;background:#0e1333}
  .card .img img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;filter:saturate(105%) contrast(1.05);transform:scale(1.02);transition:transform .35s ease}
  .card:hover .img img{transform:scale(1.07)}
  .card .meta{position:absolute;bottom:0;left:0;right:0;padding:18px;background:linear-gradient(180deg, transparent, rgba(6,9,19,.75) 34%, rgba(6,9,19,.95))}
  .card .title{font-size:clamp(18px,4.2vw,22px);font-weight:800;text-shadow:0 2px 18px rgba(0,0,0,.65);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .card .sub{font-size:13px;font-family:Inter;color:var(--muted)}
  .visualizer{width:100%;height:4px;background:rgba(255,255,255,.1);border-radius:2px;overflow:hidden;margin-top:8px}
  .visualizer-bar{width:100%;height:100%;background:linear-gradient(90deg, var(--secondary), var(--primary));transform:scaleX(0);transition:transform .1s ease;transform-origin:left}
  .card.playing .visualizer-bar{animation:audioWave 2s ease-in-out infinite}
  @keyframes audioWave{0%,100%{transform:scaleX(.3)}50%{transform:scaleX(1)}}
  .loading{display:flex;align-items:center;justify-content:center;padding:40px;font-family:Inter;color:var(--muted);grid-column:1/-1}

  /* Modal */
  .modal-backdrop{position:fixed;inset:0;display:none;place-items:center;background:rgba(0,6,20,.62);z-index:30;backdrop-filter:blur(6px);transition:opacity .2s ease}
  .modal{width:min(92vw,520px);background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));border:1px solid rgba(255,255,255,.1);border-radius:22px;padding:20px;box-shadow:0 20px 80px rgba(0,0,0,.6);transform:translateY(10px) scale(.98);transition:transform .25s ease,opacity .25s ease}
  .modal.open{transform:translateY(0) scale(1)}
  .modal h3{margin:8px 0 14px;font-size:22px}
  .modal-tabs{display:flex;gap:4px;margin-bottom:16px;background:rgba(0,0,0,.2);border-radius:12px;padding:4px}
  .modal-tab{flex:1;padding:8px 16px;border-radius:8px;background:transparent;border:none;color:var(--muted);cursor:pointer;transition:all .2s ease;font-weight:600}
  .modal-tab.active{background:rgba(255,255,255,.1);color:var(--text)}
  .tab-content{display:none}.tab-content.active{display:block}
  .field{display:grid;gap:8px;margin-bottom:12px}
  .field label{font-family:Inter;font-size:13px;color:var(--muted)}
  .field input,.field select{padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:rgba(0,0,0,.35);color:var(--text);outline:none;font-family:Inter}
  .field input:focus,.field select:focus{border-color:var(--primary)}
  .file-input-wrapper{position:relative;display:inline-block;cursor:pointer;width:100%}
  .file-input-wrapper input[type=file]{position:absolute;opacity:0;width:100%;height:100%;cursor:pointer}
  .file-input-display{padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:rgba(0,0,0,.35);color:var(--muted);transition:border-color .2s ease;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}
  .file-input-wrapper:hover .file-input-display{border-color:var(--primary)}
  .row{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end;margin-top:8px}
  .ghost{background:transparent}
  .primary{background:linear-gradient(90deg, rgba(39,224,255,.95), rgba(138,92,255,.95));border:none;color:#02101a;font-weight:800}
  .toast{position:fixed;bottom:calc(16px + env(safe-area-inset-bottom));left:50%;transform:translateX(-50%) translateY(20px);background:rgba(12,18,40,.9);border:1px solid rgba(255,255,255,.12);border-radius:14px;padding:12px 18px;font-family:Inter;font-weight:600;font-size:14px;color:var(--text);z-index:40;opacity:0;visibility:hidden;transition:all .3s ease;box-shadow:0 10px 40px rgba(0,0,0,.55);backdrop-filter:blur(8px)}
  .toast.show{opacity:1;visibility:visible;transform:translateX(-50%) translateY(0)}

  /* Player screen */
  #screen-player{position:fixed;inset:0;z-index:100}
  .player-bg{position:absolute;inset:0;background-size:cover;background-position:center;filter:blur(30px) brightness(.6);transform:scale(1.2);transition:background-image .5s ease;z-index:1}
  .player-container{position:relative;width:min(100% - 40px, 420px);background:rgba(11,16,34,.75);backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,.1);border-radius:28px;padding:24px;text-align:center;box-shadow:0 20px 80px rgba(0,0,0,.6);z-index:3}
  .cover-art{width:100%;padding-top:100%;position:relative;border-radius:22px;overflow:hidden;margin-bottom:24px;box-shadow:0 10px 40px rgba(0,0,0,.4);transition:opacity .3s ease}
  .cover-art img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;transition:opacity .3s ease}
  .cover-art.video-mode img{opacity:0}
  .youtube-player-wrapper{position:absolute;inset:0;opacity:0;pointer-events:none;transition:opacity .3s ease;z-index:2;border-radius:inherit;overflow:hidden}
  .youtube-player-wrapper.active{opacity:1;pointer-events:auto}
  .youtube-player-wrapper iframe{width:100%;height:100%;border:none}

  .track-info .title{font-size:26px;font-weight:700;margin:0;line-height:1.2}
  .track-info .artist{font-family:'Inter',sans-serif;color:var(--muted);margin-top:6px;font-size:16px}
  .progress-container{margin-top:20px}
  .progress-bar{-webkit-appearance:none;appearance:none;width:100%;height:6px;background:rgba(255,255,255,.2);border-radius:5px;outline:none;cursor:pointer}
  .progress-bar::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:16px;height:16px;background:var(--primary);border-radius:50%;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,.3)}
  .progress-bar::-moz-range-thumb{width:16px;height:16px;background:var(--primary);border-radius:50%;cursor:pointer;border:none;box-shadow:0 2px 8px rgba(0,0,0,.3)}
  .time-stamps{display:flex;justify-content:space-between;font-family:Inter;font-size:12px;margin-top:6px;color:var(--muted)}
  .main-controls{display:flex;justify-content:center;align-items:center;gap:20px;margin-top:16px}
  .main-controls button{background:none;border:none;color:var(--text);cursor:pointer;padding:10px;border-radius:50%;display:grid;place-items:center;transition:background .2s ease,color .2s ease,transform .1s ease}
  .main-controls button:hover{background:rgba(255,255,255,.1)}
  .main-controls button:active{transform:scale(.95)}
  .main-controls button.active{color:var(--primary)}
  .main-controls .icon{width:28px;height:28px}
  .main-controls button#playPauseBtn{background:linear-gradient(90deg, rgba(39,224,255,.95), rgba(138,92,255,.95));color:#02101a;transform:scale(1.1)}
  .main-controls button#playPauseBtn:hover{background:linear-gradient(90deg, rgba(39,224,255,1), rgba(138,92,255,1));transform:scale(1.15)}
  .main-controls button#playPauseBtn:active{transform:scale(1.05)}
  .main-controls button#playPauseBtn .icon{width:36px;height:36px}
  .secondary-controls{display:flex;align-items:center;justify-content:space-between;margin-top:16px;gap:15px}
  .secondary-controls .icon{width:20px;height:20px;color:var(--muted)}
  .volume-slider{flex-grow:1;-webkit-appearance:none;appearance:none;width:100%;height:4px;background:rgba(255,255,255,.2);border-radius:5px;outline:none}
  .volume-slider::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:14px;height:14px;background:var(--text);border-radius:50%;cursor:pointer}
  .volume-slider::-moz-range-thumb{width:14px;height:14px;background:var(--text);border-radius:50%;cursor:pointer;border:none}

  .back-link{position:fixed;top:20px;left:20px;z-index:110}
  .queue-info{position:fixed;bottom:20px;right:20px;background:rgba(11,16,34,.8);backdrop-filter:blur(8px);border-radius:12px;padding:8px 12px;font-family:Inter;font-size:12px;color:var(--muted);border:1px solid rgba(255,255,255,.1)}

  .subsection{margin-top:40px}
  .gallery-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:16px}
  .artist-card{position:relative;border-radius:16px;overflow:hidden;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);box-shadow:0 8px 30px rgba(0,0,0,.35);transition:transform .25s, box-shadow .25s}
  .artist-card:hover{transform:translateY(-4px);box-shadow:0 18px 50px rgba(0,0,0,.45)}
  .artist-card img{width:100%;height:180px;object-fit:cover;display:block;filter:saturate(105%) contrast(1.05)}
  .artist-meta{padding:12px}
  .artist-name{font-weight:800;font-size:16px}
  .artist-link{font-family:Inter;color:var(--secondary);font-size:12px;text-decoration:none}
  .artist-link:hover{text-decoration:underline}

  @media(prefers-reduced-motion:reduce){.cta,.card,.orb{animation:none!important}.card:hover{transform:none}}
  @media(max-width:480px){
    .hero h1{font-size:clamp(32px,10vw,80px)}
    .player-container{width:calc(100% - 20px);padding:20px}
    .main-controls{gap:15px}
    .main-controls .icon{width:24px;height:24px}
    .main-controls button#playPauseBtn .icon{width:32px;height:32px}
    .modal-tabs{flex-direction:column}
    .modal-tab{text-align:center}
  }

  #particles{position:fixed;inset:0;z-index:0;pointer-events:none}
</style>
</head>
<body>
<canvas id="particles" aria-hidden="true"></canvas>

<div class="orbs" aria-hidden="true">
  <span class="orb" style="top:20%;left:10%;animation-delay:-5s"></span>
  <span class="orb pink" style="top:60%;right:15%;animation-delay:-2s"></span>
  <span class="orb violet" style="bottom:30%;left:70%;animation-delay:-8s"></span>
</div>

<section id="screen-hero" class="screen">
  <div class="container hero">
    <h1 class="neon">NITIN’S<br/>PLAYLIST</h1>
    <p>Experience music in a new dimension. Upload MP3s or add YouTube songs—same neon theme, smooth animations, and a dedicated video player view.</p>
    <a href="#main" class="cta" id="enterBtn"><span>Enter the Music</span></a>
  </div>
</section>

<section id="screen-main" class="screen hidden">
  <div class="container">
    <header>
      <h2 class="neon" style="font-size:clamp(28px,8vw,62px)">Nitin’s Playlist</h2>
      <div class="actions">
        <button class="btn" id="addBtn">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>
          Add Song
        </button>
        <button class="btn youtube" id="addYouTubeBtn">
          <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>
          YouTube
        </button>
      </div>
    </header>

    <div class="subsection">
      <h3 class="neon" style="font-size:clamp(22px,5vw,34px)">About</h3>
      <p style="font-family:Inter;color:var(--muted);max-width:60ch">Play local audio on the main page or open a separate neon video-player screen for YouTube tracks. Same layout, same animations.</p>
    </div>

    <div class="subsection" id="gallery">
      <h3 class="neon" style="font-size:clamp(22px,5vw,34px)">Trending Artists (Clickable)</h3>
      <div class="gallery-grid" id="artistGrid"></div>
    </div>

    <div class="subsection">
      <h3 class="neon" style="font-size:clamp(22px,5vw,34px)">Your Playlist</h3>
      <div class="search-container"><input type="text" id="searchInput" placeholder="Search your songs..."/></div>
      <div class="grid" id="grid"></div>
    </div>
  </div>
</section>

<section id="screen-player" class="screen hidden">
  <div class="player-bg" id="playerBg"></div>
  <a id="backToPlaylistBtn" class="back-link btn" aria-label="Back to playlist" href="?">
    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>
  </a>

  <div class="player-container">
    <div class="cover-art" id="coverArt">
      <img id="coverImg" alt="Track cover art"/>
      <div class="youtube-player-wrapper" id="youtubePlayerWrapper">
        <div id="ytEmbed"></div>
      </div>
    </div>
    <div class="track-info">
      <h2 id="trackTitle" class="title neon">Select a Song</h2>
      <p id="trackArtist" class="artist">Choose from your playlist</p>
    </div>

    <!-- Audio timeline (hidden for YouTube) -->
    <div class="progress-container" id="audioUi">
      <input type="range" class="progress-bar" id="progressBar" value="0" min="0" max="100"/>
      <div class="time-stamps">
        <span id="currentTime">0:00</span><span id="totalDuration">0:00</span>
      </div>
    </div>

    <div class="main-controls" id="controlsUi">
      <button id="playPauseBtn" aria-label="Play">
        <svg class="icon" id="playIcon" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
        <svg class="icon hidden" id="pauseIcon" viewBox="0 0 24 24" fill="currentColor"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
      </button>
      <input type="range" class="volume-slider" id="volumeSlider" value="70" min="0" max="100" title="Volume"/>
    </div>
  </div>
</section>

<div class="queue-info" id="queueInfo">0 / 0</div>

<!-- Modal -->
<div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-labelledby="modalTitle">
  <div class="modal" id="modal">
    <h3 class="neon" id="modalTitle">Add a Song</h3>
    <div class="modal-tabs">
      <button class="modal-tab active" data-tab="file">Audio File</button>
      <button class="modal-tab" data-tab="youtube">YouTube</button>
    </div>

    <div class="tab-content active" id="file-tab">
      <form id="file-form" onsubmit="return false;">
        <div class="field"><label for="titleInput">Song Title *</label><input id="titleInput" placeholder="e.g., My Favorite Song" required/></div>
        <div class="field"><label for="artistInput">Artist *</label><input id="artistInput" placeholder="e.g., Amazing Artist" required/></div>
        <div class="field">
          <label for="imageInput">Cover Image</label>
          <div class="file-input-wrapper">
            <input id="imageInput" type="file" accept="image/*"/>
            <span class="file-input-display" id="imageInputDisplay">Choose cover image (optional)</span>
          </div>
        </div>
        <div class="field">
          <label for="audioInput">Audio File *</label>
          <div class="file-input-wrapper">
            <input id="audioInput" type="file" accept="audio/*" required/>
            <span class="file-input-display" id="audioInputDisplay">Choose audio file</span>
          </div>
        </div>
      </form>
    </div>

    <div class="tab-content" id="youtube-tab">
      <form id="youtube-form" onsubmit="return false;">
        <div class="field"><label for="youtubeUrlInput">YouTube URL *</label><input id="youtubeUrlInput" placeholder="https://www.youtube.com/watch?v=..." required/></div>
        <div class="field"><label for="youtubeTitle">Song Title *</label><input id="youtubeTitle" placeholder="e.g., Song Title" required/></div>
        <div class="field"><label for="youtubeArtist">Artist *</label><input id="youtubeArtist" placeholder="e.g., Artist" required/></div>
        <div class="field"><small style="color:var(--muted);font-family:Inter;font-size:12px">Tip: Use official music video links for best results.</small></div>
      </form>
    </div>

    <div class="row">
      <button class="btn ghost" id="cancelBtn">Cancel</button>
      <button class="btn primary" id="saveBtn">Add Song</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>
<audio id="audioPlayer" preload="metadata"></audio>

<script>
(() => {
  /* ---------- Background particles ---------- */
  const c = document.getElementById('particles');
  const ctx = c.getContext('2d');
  let W,H; const resize = ()=>{W=c.width=innerWidth; H=c.height=innerHeight}; addEventListener('resize', resize, {passive:true}); resize();
  const P = Array.from({length:120}, ()=>({x:Math.random()*W,y:Math.random()*H,vx:(Math.random()-.5)*.5,vy:(Math.random()-.5)*.5,r:Math.random()*3+1,h:Math.random()*360}));
  (function loop(){ctx.fillStyle='rgba(6,9,19,.25)'; ctx.fillRect(0,0,W,H); for(const p of P){p.x+=p.vx;p.y+=p.vy;p.h=(p.h+.5)%360;if(p.x<0||p.x>W||p.y<0||p.y>H){p.x=Math.random()*W;p.y=Math.random()*H} ctx.beginPath(); ctx.fillStyle=`hsla(${p.h},100%,60%,0.7)`; ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill();} requestAnimationFrame(loop);})();

  /* ---------- App state ---------- */
  const fallbackCover = 'https://picsum.photos/seed/cover/900/900';
  let songs = [
    // Demo YouTube (embeddable, replace with your own)
    { id:'yt1', title:'STAY', artist:'The Kid LAROI & Justin Bieber', type:'youtube', videoId:'kTJczUoc26U', coverUrl:'https://img.youtube.com/vi/kTJczUoc26U/hqdefault.jpg' },
    { id:'yt2', title:'Levitating', artist:'Dua Lipa', type:'youtube', videoId:'TUVcZfQe-Kw', coverUrl:'https://img.youtube.com/vi/TUVcZfQe-Kw/hqdefault.jpg' },
    // Demo audio (safe CC samples)
    { id:'aud1', title:'Dino Roar (Sample)', artist:'CC0 Sample', type:'file', audioDemo:'https://interactive-examples.mdn.mozilla.net/media/cc0-audio/t-rex-roar.mp3', coverUrl:fallbackCover },
    { id:'aud2', title:'Beer Pour (Sample)', artist:'CC0 Sample', type:'file', audioDemo:'https://interactive-examples.mdn.mozilla.net/media/cc0-audio/beer.mp3', coverUrl:fallbackCover },
  ];
  let currentSongIndex = -1, activePlayer = 'none', isPlaying = false;
  let currentTabInModal = 'file';

  /* ---------- DOM ---------- */
  const $ = s=>document.querySelector(s), $$ = s=>document.querySelectorAll(s);
  const heroScreen = $('#screen-hero'), mainScreen = $('#screen-main'), playerScreen = $('#screen-player');
  const grid = $('#grid'), searchInput = $('#searchInput');
  const toast = $('#toast'), queueInfo = $('#queueInfo');

  const audioPlayer = $('#audioPlayer');
  const playerBg = $('#playerBg'), coverArt = $('#coverArt'), coverImg = $('#coverImg');
  const trackTitle = $('#trackTitle'), trackArtist = $('#trackArtist');
  const audioUi = $('#audioUi'), progressBar = $('#progressBar'), currentTimeEl = $('#currentTime'), totalDurationEl = $('#totalDuration');
  const playPauseBtn = $('#playPauseBtn'), playIcon = $('#playIcon'), pauseIcon = $('#pauseIcon'), volumeSlider = $('#volumeSlider');
  const youtubePlayerWrapper = $('#youtubePlayerWrapper');
  const enterBtn = $('#enterBtn'), addBtn = $('#addBtn'), addYouTubeBtn = $('#addYouTubeBtn');
  const modalBackdrop = $('#modalBackdrop'), modal = $('#modal');
  const modalTabs = $$('.modal-tab'), saveBtn = $('#saveBtn'), cancelBtn = $('#cancelBtn');

  /* ---------- Utils ---------- */
  const generateId = () => Date.now().toString(36)+Math.random().toString(36).slice(2,9);
  const formatTime = s => isNaN(s) ? '0:00' : `${Math.floor(s/60)}:${String(Math.floor(s%60)).padStart(2,'0')}`;
  const showToast = (msg,type='success') => { toast.textContent=msg; toast.style.background = type==='error' ? 'rgba(255,63,180,.9)' : 'rgba(12,18,40,.9)'; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'), 2600); };
  const updateQueueInfo = () => { queueInfo.textContent = `${currentSongIndex>=0?currentSongIndex+1:0} / ${songs.length}`; };
  const extractYouTubeVideoId = (url) => { const r=/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/; const m=url.match(r); return m?m[1]:null; };

  const showScreen = id => { [heroScreen, mainScreen, playerScreen].forEach(s=>s.classList.toggle('hidden', s.id!==id)); };

  /* ---------- Gallery (reliable images + fallback) ---------- */
  const artistGrid = $('#artistGrid');
  const artists = [
    {name:'Doechii', link:'https://www.google.com/search?q=Doechii+official', img:'https://picsum.photos/id/1011/600/400'},
    {name:'Royel Otis', link:'https://www.google.com/search?q=Royel+Otis+official', img:'https://picsum.photos/id/1027/600/400'},
    {name:'Kenya Grace', link:'https://www.google.com/search?q=Kenya+Grace+official', img:'https://picsum.photos/id/1035/600/400'},
    {name:'CHINCHILLA', link:'https://www.google.com/search?q=CHINCHILLA+singer+official', img:'https://picsum.photos/id/1041/600/400'},
    {name:'Shaboozey', link:'https://www.google.com/search?q=Shaboozey+official', img:'https://picsum.photos/id/1050/600/400'},
    {name:'Chella', link:'https://www.google.com/search?q=Chella+singer+official', img:'https://picsum.photos/id/1067/600/400'},
    {name:'2hollis', link:'https://www.google.com/search?q=2hollis+official', img:'https://picsum.photos/id/1074/600/400'},
    {name:'Flo Milli', link:'https://www.google.com/search?q=Flo+Milli+official', img:'https://picsum.photos/id/1084/600/400'},
    {name:'iann dior', link:'https://www.google.com/search?q=Iann+Dior+official', img:'https://picsum.photos/id/1080/600/400'},
    {name:'Gracie Abrams', link:'https://www.google.com/search?q=Gracie+Abrams+official', img:'https://picsum.photos/id/1081/600/400'},
    {name:'Tyla', link:'https://www.google.com/search?q=Tyla+official', img:'https://picsum.photos/id/1082/600/400'},
    {name:'Tate McRae', link:'https://www.google.com/search?q=Tate+McRae+official', img:'https://picsum.photos/id/1083/600/400'},
    {name:'Ice Spice', link:'https://www.google.com/search?q=Ice+Spice+official', img:'https://picsum.photos/id/1085/600/400'},
    {name:'Reneé Rapp', link:'https://www.google.com/search?q=Renee+Rapp+official', img:'https://picsum.photos/id/1086/600/400'},
    {name:'Chappell Roan', link:'https://www.google.com/search?q=Chappell+Roan+official', img:'https://picsum.photos/id/1087/600/400'},
    {name:'Benson Boone', link:'https://www.google.com/search?q=Benson+Boone+official', img:'https://picsum.photos/id/1089/600/400'},
    {name:'PinkPantheress', link:'https://www.google.com/search?q=PinkPantheress+official', img:'https://picsum.photos/id/109/600/400'},
    {name:'RAYE', link:'https://www.google.com/search?q=RAYE+official', img:'https://picsum.photos/id/110/600/400'},
    {name:'Noah Kahan', link:'https://www.google.com/search?q=Noah+Kahan+official', img:'https://picsum.photos/id/111/600/400'},
    {name:'Alex Warren', link:'https://www.google.com/search?q=Alex+Warren+official', img:'https://picsum.photos/id/112/600/400'}
  ];
  artistGrid.innerHTML = artists.map(a => `
    <a class="artist-card" href="${a.link}" target="_blank" rel="noopener">
      <img src="${a.img}" alt="${a.name}" loading="lazy" onerror="this.onerror=null;this.src='https://picsum.photos/seed/${encodeURIComponent(a.name)}/600/400';"/>
      <div class="artist-meta">
        <div class="artist-name">${a.name}</div>
        <span class="artist-link">View profile ↗</span>
      </div>
    </a>
  `).join('');

  /* ---------- Playlist rendering ---------- */
  function createCardHTML(song, idx){
    const isSelected = idx===currentSongIndex;
    const ytBadge = song.type==='youtube' ? '<div class="youtube-badge">YouTube</div>' : '';
    const cover = song.coverUrl || fallbackCover;
    return `
      <article class="card ${song.type==='youtube'?'youtube':''} ${isSelected?'playing':''}" data-index="${idx}">
        <button class="delete-btn" title="Delete">&times;</button>
        ${ytBadge}
        <div class="play-indicator"><svg width="24" height="24" fill="#fff" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></div>
        <div class="glow" aria-hidden="true"></div>
        <div class="img"><img src="${cover}" alt="${song.title} cover" loading="lazy" onerror="this.onerror=null;this.src='${fallbackCover}'"/></div>
        <div class="meta">
          <div class="title">${song.title}</div>
          <div class="sub">${song.artist||''}</div>
          ${isSelected?`<div class="visualizer"><div class="visualizer-bar"></div></div>`:''}
        </div>
      </article>`;
  }
  function renderPlaylist(filter=''){
    const f = filter.toLowerCase();
    const list = songs.filter(s => s.title.toLowerCase().includes(f) || (s.artist||'').toLowerCase().includes(f));
    if (!songs.length){ grid.innerHTML='<div class="loading">No songs yet. Add a few!</div>'; return; }
    if (!list.length){ grid.innerHTML='<div class="loading">No songs match your search.</div>'; return; }
    grid.innerHTML = list.map(s => createCardHTML(s, songs.findIndex(x=>x.id===s.id))).join('');
  }

  /* ---------- Modal ---------- */
  const openModal = (tab='file')=>{
    $('#youtube-form').reset(); $('#file-form').reset();
    $('#imageInputDisplay').textContent="Choose cover image (optional)";
    $('#audioInputDisplay').textContent="Choose audio file";
    modalBackdrop.style.display="grid"; switchTab(tab); setTimeout(()=>modal.classList.add('open'),10);
  };
  const closeModal = ()=>{ modal.classList.remove('open'); setTimeout(()=>{modalBackdrop.style.display='none'},250); };
  const switchTab = id => { currentTabInModal=id; $$('.modal-tab').forEach(t=>t.classList.toggle('active', t.dataset.tab===id)); $$('.tab-content').forEach(c=>c.classList.toggle('active', c.id===`${id}-tab`)); };
  const handleSave = ()=> currentTabInModal==='file'?saveFileSong():saveYouTubeSong();
  $('#imageInput').addEventListener('change', e=> $('#imageInputDisplay').textContent = e.target.files[0]?.name || "Choose cover image (optional)");
  $('#audioInput').addEventListener('change', e=> $('#audioInputDisplay').textContent = e.target.files[0]?.name || "Choose audio file");

  function saveFileSong(){
    const title=$('#titleInput').value.trim(), artist=$('#artistInput').value.trim();
    const img=$('#imageInput').files[0], audio=$('#audioInput').files[0];
    if(!title||!artist||!audio) return showToast('Please fill all required fields.','error');
    songs.push({ id:generateId(), title, artist, type:'file', audioUrl:URL.createObjectURL(audio), coverUrl:img?URL.createObjectURL(img):fallbackCover });
    renderPlaylist(searchInput.value); updateQueueInfo(); closeModal(); showToast(`"${title}" added!`);
  }
  function saveYouTubeSong(){
    const url=$('#youtubeUrlInput').value.trim(), title=$('#youtubeTitle').value.trim(), artist=$('#youtubeArtist').value.trim();
    const videoId = extractYouTubeVideoId(url);
    if(!videoId) return showToast('Invalid YouTube URL.','error');
    if(!title||!artist) return showToast('Please add title and artist.','error');
    const cover = `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`;
    songs.push({ id:generateId(), title, artist, type:'youtube', videoId, coverUrl:cover });
    renderPlaylist(searchInput.value); updateQueueInfo(); closeModal(); showToast(`"${title}" added!`);
  }

  /* ---------- Audio playback (inline on main screen) ---------- */
  function playFileInline(index){
    currentSongIndex=index; const song=songs[index];
    audioPlayer.src = song.audioUrl || song.audioDemo; audioPlayer.play().catch(()=>{});
    isPlaying=true; activePlayer='audio'; renderPlaylist(searchInput.value); updateQueueInfo();
  }
  audioPlayer.addEventListener('timeupdate', ()=>{ progressBar.value=(audioPlayer.currentTime/audioPlayer.duration)*100||0; currentTimeEl.textContent=formatTime(audioPlayer.currentTime); });
  audioPlayer.addEventListener('loadedmetadata', ()=> totalDurationEl.textContent = formatTime(audioPlayer.duration||0));
  audioPlayer.addEventListener('play', ()=>{ isPlaying=true; activePlayer='audio'; updatePlayPauseIcon(); });
  audioPlayer.addEventListener('pause', ()=>{ isPlaying=false; updatePlayPauseIcon(); });

  /* ---------- YouTube Player (reliable via IFrame API) ---------- */
  let ytPlayer=null, ytAPIReady=false, pendingVideoId=null;
  window.onYouTubeIframeAPIReady = ()=>{ ytAPIReady=true; if(pendingVideoId){ createYTPlayer(pendingVideoId); pendingVideoId=null; } };
  function ensureYTScript(){
    if (document.getElementById('ytapi')) return;
    const s=document.createElement('script'); s.id='ytapi'; s.src='https://www.youtube.com/iframe_api'; document.body.appendChild(s);
  }
  function createYTPlayer(videoId){
    if(ytPlayer){ ytPlayer.loadVideoById(videoId); return; }
    ytPlayer = new YT.Player('ytEmbed', {
      videoId, playerVars:{autoplay:0, rel:0, playsinline:1},
      events:{
        onReady:()=>{/* wait for user button to play */},
        onStateChange:(e)=>{
          if(e.data===YT.PlayerState.PLAYING){ isPlaying=true; updatePlayPauseIcon(); }
          if(e.data===YT.PlayerState.PAUSED || e.data===YT.PlayerState.ENDED){ isPlaying=false; updatePlayPauseIcon(); }
        }
      }
    });
  }

  function openVideoPlayerScreen(song){
    // Update URL without reloading (new "page" feel)
    const url = new URL(location.href.split('?')[0], location.origin);
    url.searchParams.set('type','youtube');
    url.searchParams.set('id', song.videoId);
    url.searchParams.set('title', song.title);
    url.searchParams.set('artist', song.artist||'');
    if (song.coverUrl) url.searchParams.set('cover', song.coverUrl);
    history.pushState({}, '', url.toString());
    enterPlayerFromParams();
  }

  function enterPlayerFromParams(){
    const q = new URLSearchParams(location.search);
    const type = q.get('type');
    if(!type){ showScreen('screen-hero'); return; }
    showScreen('screen-player');

    const title=q.get('title')||'Now Playing', artist=q.get('artist')||'', cover=q.get('cover')||fallbackCover;
    trackTitle.textContent = title; trackArtist.textContent = artist;
    coverImg.src = cover; coverImg.onerror = ()=>{ coverImg.onerror=null; coverImg.src=fallbackCover; };
    playerBg.style.backgroundImage = `url(${cover})`;

    if(type==='youtube'){
      coverArt.classList.add('video-mode');
      youtubePlayerWrapper.classList.add('active');
      audioUi.style.display='none';
      activePlayer='youtube'; isPlaying=false; updatePlayPauseIcon();

      ensureYTScript();
      const v = q.get('id');
      if(ytAPIReady) createYTPlayer(v); else pendingVideoId=v;
    } else if (type==='audio'){
      // Optional: dedicated audio page
      const src=q.get('src'); coverArt.classList.remove('video-mode'); youtubePlayerWrapper.classList.remove('active');
      audioUi.style.display='block'; audioPlayer.src=src; audioPlayer.play().catch(()=>{}); activePlayer='audio'; isPlaying=true; updatePlayPauseIcon();
    }
    updateQueueInfo();
  }

  /* ---------- Controls ---------- */
  function updatePlayPauseIcon(){ playIcon.classList.toggle('hidden', isPlaying); pauseIcon.classList.toggle('hidden', !isPlaying); playPauseBtn.setAttribute('aria-label', isPlaying?'Pause':'Play'); }

  playPauseBtn.addEventListener('click', ()=>{
    if(activePlayer==='audio'){
      if(audioPlayer.paused) audioPlayer.play().catch(()=>{}); else audioPlayer.pause();
    } else if(activePlayer==='youtube'){
      if(!ytPlayer) return; const s=ytPlayer.getPlayerState();
      if(s===YT.PlayerState.PLAYING) ytPlayer.pauseVideo(); else ytPlayer.playVideo();
    }
  });

  volumeSlider.addEventListener('input', ()=>{
    const v = volumeSlider.value|0;
    audioPlayer.volume = v/100;
    if (ytPlayer && typeof ytPlayer.setVolume==='function') ytPlayer.setVolume(v);
  });
  audioPlayer.volume = volumeSlider.value/100;

  progressBar.addEventListener('input', ()=>{
    if(activePlayer==='audio' && audioPlayer.duration){ audioPlayer.currentTime = (progressBar.value/100)*audioPlayer.duration; }
  });

  /* ---------- UI events ---------- */
  $('#imageInput'); $('#audioInput');
  $('#imageInput').addEventListener('change', e=> $('#imageInputDisplay').textContent = e.target.files[0]?.name || "Choose cover image (optional)");
  $('#audioInput').addEventListener('change', e=> $('#audioInputDisplay').textContent = e.target.files[0]?.name || "Choose audio file");
  enterBtn.addEventListener('click', e=>{e.preventDefault(); showScreen('screen-main');});
  addBtn.addEventListener('click', ()=> openModal('file'));
  addYouTubeBtn.addEventListener('click', ()=> openModal('youtube'));
  modalTabs.forEach(t=>t.addEventListener('click', ()=> switchTab(t.dataset.tab)));
  saveBtn.addEventListener('click', handleSave);
  cancelBtn.addEventListener('click', closeModal);
  modalBackdrop.addEventListener('click', e=>{ if(e.target===modalBackdrop) closeModal(); });

  searchInput.addEventListener('input', ()=> renderPlaylist(searchInput.value));

  grid.addEventListener('click', e=>{
    const card = e.target.closest('.card'); if(!card) return;
    const index = +card.dataset.index;
    if (e.target.closest('.delete-btn')){
      const wasPlaying = (index===currentSongIndex);
      const removed = songs.splice(index,1)[0];
      if(removed?.audioUrl?.startsWith('blob:')) URL.revokeObjectURL(removed.audioUrl);
      if(removed?.coverUrl?.startsWith('blob:')) URL.revokeObjectURL(removed.coverUrl);
      if(index<currentSongIndex) currentSongIndex--;
      if(wasPlaying){ audioPlayer.pause(); currentSongIndex=-1; }
      renderPlaylist(searchInput.value); updateQueueInfo(); showToast('Song deleted'); return;
    }
    const song = songs[index];
    if(song.type==='youtube'){ openVideoPlayerScreen(song); }
    else { playFileInline(index); }
  });

  $('#backToPlaylistBtn').addEventListener('click', (e)=>{
    e.preventDefault();
    if(activePlayer==='youtube' && ytPlayer){ try{ ytPlayer.stopVideo(); }catch(_){} }
    if(activePlayer==='audio'){ audioPlayer.pause(); }
    history.pushState({},'',location.pathname);
    showScreen('screen-main');
  });

  window.addEventListener('popstate', ()=> enterPlayerFromParams());

  /* ---------- Init ---------- */
  function init(){
    renderPlaylist(); updateQueueInfo();
    // Detect direct link like ?type=youtube...
    const hasType = new URLSearchParams(location.search).get('type');
    if(hasType) enterPlayerFromParams();
  }
  init();
})();
</script>

<!-- Load YT API last (creates window.YT + onYouTubeIframeAPIReady) -->
<script id="ytapi" src="https://www.youtube.com/iframe_api"></script>
</body>
</html>
